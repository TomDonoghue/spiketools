<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Statistical Analyses &#8212; spiketools 0.1.0rc2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          spiketools</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1.0rc2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../glossary.html">Glossary</a></li>
                <li><a href="index.html">Tutorials</a></li>
                <li><a href="https://github.com/spiketools/spiketools">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-tutorials-plot-stats-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="statistical-analyses">
<span id="sphx-glr-auto-tutorials-plot-stats-py"></span><h1>Statistical Analyses<a class="headerlink" href="#statistical-analyses" title="Permalink to this heading">¶</a></h1>
<p>Apply statistical analyses to spiking data.</p>
<p>This tutorial primarily covers the <code class="docutils literal notranslate"><span class="pre">spiketools.stats</span></code> module.</p>
<section id="applying-statistical-measures-to-spiking-data">
<h2>Applying statistical measures to spiking data<a class="headerlink" href="#applying-statistical-measures-to-spiking-data" title="Permalink to this heading">¶</a></h2>
<p>This tutorial covers applying statistical measures to spiking data.</p>
<section id="sections">
<h3>Sections<a class="headerlink" href="#sections" title="Permalink to this heading">¶</a></h3>
<p>This tutorial contains the following sections:</p>
<ol class="arabic simple">
<li><p>Compute and plot different shuffles of spikes</p></li>
<li><p>Compute t-test t- and p-values to test for an event-related firing rate change</p></li>
<li><p>Compare first and last half of trials</p></li>
<li><p>Run a 2-way ANOVA on multiple trials data</p></li>
<li><p>Compute empirical p-value and z-score from distribution of surrogates</p></li>
<li><p>Compute f-value from spiking data using 1-way ANOVA</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import auxiliary libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Import statistics-related functions</span>
<span class="kn">from</span> <span class="nn">spiketools.stats.shuffle</span> <span class="kn">import</span> <a href="../generated/spiketools.stats.shuffle.shuffle_spikes.html#spiketools.stats.shuffle.shuffle_spikes" title="spiketools.stats.shuffle.shuffle_spikes" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_spikes</span></a><span class="p">,</span> <a href="../generated/spiketools.stats.shuffle.shuffle_isis.html#spiketools.stats.shuffle.shuffle_isis" title="spiketools.stats.shuffle.shuffle_isis" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_isis</span></a><span class="p">,</span> <a href="../generated/spiketools.stats.shuffle.shuffle_circular.html#spiketools.stats.shuffle.shuffle_circular" title="spiketools.stats.shuffle.shuffle_circular" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_circular</span></a><span class="p">,</span> <a href="../generated/spiketools.stats.shuffle.shuffle_bins.html#spiketools.stats.shuffle.shuffle_bins" title="spiketools.stats.shuffle.shuffle_bins" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_bins</span></a>
<span class="kn">from</span> <span class="nn">spiketools.stats.permutations</span> <span class="kn">import</span> <a href="../generated/spiketools.stats.permutations.compute_surrogate_stats.html#spiketools.stats.permutations.compute_surrogate_stats" title="spiketools.stats.permutations.compute_surrogate_stats" class="sphx-glr-backref-module-spiketools-stats-permutations sphx-glr-backref-type-py-function"><span class="n">compute_surrogate_stats</span></a>
<span class="kn">from</span> <span class="nn">spiketools.stats.anova</span> <span class="kn">import</span> <a href="../generated/spiketools.stats.anova.create_dataframe.html#spiketools.stats.anova.create_dataframe" title="spiketools.stats.anova.create_dataframe" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">create_dataframe</span></a><span class="p">,</span> <a href="../generated/spiketools.stats.anova.create_dataframe_bins.html#spiketools.stats.anova.create_dataframe_bins" title="spiketools.stats.anova.create_dataframe_bins" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">create_dataframe_bins</span></a><span class="p">,</span> <a href="../generated/spiketools.stats.anova.fit_anova.html#spiketools.stats.anova.fit_anova" title="spiketools.stats.anova.fit_anova" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">fit_anova</span></a>
<span class="kn">from</span> <span class="nn">spiketools.stats.trials</span> <span class="kn">import</span> <span class="p">(</span><a href="../generated/spiketools.stats.trials.compute_pre_post_ttest.html#spiketools.stats.trials.compute_pre_post_ttest" title="spiketools.stats.trials.compute_pre_post_ttest" class="sphx-glr-backref-module-spiketools-stats-trials sphx-glr-backref-type-py-function"><span class="n">compute_pre_post_ttest</span></a><span class="p">,</span> <a href="../generated/spiketools.stats.trials.compare_pre_post_activity.html#spiketools.stats.trials.compare_pre_post_activity" title="spiketools.stats.trials.compare_pre_post_activity" class="sphx-glr-backref-module-spiketools-stats-trials sphx-glr-backref-type-py-function"><span class="n">compare_pre_post_activity</span></a><span class="p">,</span>
                                     <a href="../generated/spiketools.stats.trials.compare_trial_frs.html#spiketools.stats.trials.compare_trial_frs" title="spiketools.stats.trials.compare_trial_frs" class="sphx-glr-backref-module-spiketools-stats-trials sphx-glr-backref-type-py-function"><span class="n">compare_trial_frs</span></a><span class="p">)</span>

<span class="c1"># Import other spiketools functions</span>
<span class="kn">from</span> <span class="nn">spiketools.sim.times</span> <span class="kn">import</span> <a href="../generated/spiketools.sim.sim_spiketimes.html#spiketools.sim.sim_spiketimes" title="spiketools.sim.sim_spiketimes" class="sphx-glr-backref-module-spiketools-sim sphx-glr-backref-type-py-function"><span class="n">sim_spiketimes</span></a>
<span class="kn">from</span> <span class="nn">spiketools.sim.train</span> <span class="kn">import</span> <a href="../generated/spiketools.sim.train.sim_spiketrain_binom.html#spiketools.sim.train.sim_spiketrain_binom" title="spiketools.sim.train.sim_spiketrain_binom" class="sphx-glr-backref-module-spiketools-sim-train sphx-glr-backref-type-py-function"><span class="n">sim_spiketrain_binom</span></a>
<span class="kn">from</span> <span class="nn">spiketools.sim.trials</span> <span class="kn">import</span> <a href="../generated/spiketools.sim.trials.sim_trials_poisson.html#spiketools.sim.trials.sim_trials_poisson" title="spiketools.sim.trials.sim_trials_poisson" class="sphx-glr-backref-module-spiketools-sim-trials sphx-glr-backref-type-py-function"><span class="n">sim_trials_poisson</span></a>
<span class="kn">from</span> <span class="nn">spiketools.measures.trials</span> <span class="kn">import</span> <a href="../generated/spiketools.measures.trials.compute_pre_post_rates.html#spiketools.measures.trials.compute_pre_post_rates" title="spiketools.measures.trials.compute_pre_post_rates" class="sphx-glr-backref-module-spiketools-measures-trials sphx-glr-backref-type-py-function"><span class="n">compute_pre_post_rates</span></a>
<span class="kn">from</span> <span class="nn">spiketools.spatial.occupancy</span> <span class="kn">import</span> <span class="p">(</span><a href="../generated/spiketools.spatial.occupancy.compute_bin_edges.html#spiketools.spatial.occupancy.compute_bin_edges" title="spiketools.spatial.occupancy.compute_bin_edges" class="sphx-glr-backref-module-spiketools-spatial-occupancy sphx-glr-backref-type-py-function"><span class="n">compute_bin_edges</span></a><span class="p">,</span> <a href="../generated/spiketools.spatial.occupancy.compute_bin_assignment.html#spiketools.spatial.occupancy.compute_bin_assignment" title="spiketools.spatial.occupancy.compute_bin_assignment" class="sphx-glr-backref-module-spiketools-spatial-occupancy sphx-glr-backref-type-py-function"><span class="n">compute_bin_assignment</span></a><span class="p">,</span>
                                          <a href="../generated/spiketools.spatial.occupancy.compute_bin_counts_assgn.html#spiketools.spatial.occupancy.compute_bin_counts_assgn" title="spiketools.spatial.occupancy.compute_bin_counts_assgn" class="sphx-glr-backref-module-spiketools-spatial-occupancy sphx-glr-backref-type-py-function"><span class="n">compute_bin_counts_assgn</span></a><span class="p">)</span>

<span class="c1"># Import plot function</span>
<span class="kn">from</span> <span class="nn">spiketools.plts.trials</span> <span class="kn">import</span> <a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a>
<span class="kn">from</span> <span class="nn">spiketools.plts.stats</span> <span class="kn">import</span> <a href="../generated/spiketools.plts.stats.plot_surrogates.html#spiketools.plts.stats.plot_surrogates" title="spiketools.plts.stats.plot_surrogates" class="sphx-glr-backref-module-spiketools-plts-stats sphx-glr-backref-type-py-function"><span class="n">plot_surrogates</span></a>
<span class="kn">from</span> <span class="nn">spiketools.plts.utils</span> <span class="kn">import</span> <a href="../generated/spiketools.plts.utils.make_axes.html#spiketools.plts.utils.make_axes" title="spiketools.plts.utils.make_axes" class="sphx-glr-backref-module-spiketools-plts-utils sphx-glr-backref-type-py-function"><span class="n">make_axes</span></a>
</pre></div>
</div>
<p>First we will generate some test data, by simulating spike times.</p>
<p>To do so, we will simulate spike times at 10Hz for 100 seconds.
In doing so, we will use the <cite>refractory</cite> settings to prevent multiple
spikes occurring too close together in time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate spike times</span>
<span class="n">spikes</span> <span class="o">=</span> <a href="../generated/spiketools.sim.sim_spiketimes.html#spiketools.sim.sim_spiketimes" title="spiketools.sim.sim_spiketimes" class="sphx-glr-backref-module-spiketools-sim sphx-glr-backref-type-py-function"><span class="n">sim_spiketimes</span></a><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;poisson&#39;</span><span class="p">,</span> <span class="n">refractory</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compute-and-plot-different-shuffles-of-spikes">
<h3>Compute and plot different shuffles of spikes<a class="headerlink" href="#compute-and-plot-different-shuffles-of-spikes" title="Permalink to this heading">¶</a></h3>
<p>Here, we will explore different shuffling approaches to create different shuffled
surrogates of our original spikes.</p>
<p>The approaches we will try are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../generated/spiketools.stats.shuffle.shuffle_isis.html#spiketools.stats.shuffle.shuffle_isis" title="spiketools.stats.shuffle.shuffle_isis"><code class="xref py py-func docutils literal notranslate"><span class="pre">shuffle_isis()</span></code></a>: shuffle spike times using permuted inter-spike intervals (isis)</p></li>
<li><p><a class="reference internal" href="../generated/spiketools.stats.shuffle.shuffle_circular.html#spiketools.stats.shuffle.shuffle_circular" title="spiketools.stats.shuffle.shuffle_circular"><code class="xref py py-func docutils literal notranslate"><span class="pre">shuffle_circular()</span></code></a>: shuffle spikes by circularly shifting the spike train</p></li>
<li><p><a class="reference internal" href="../generated/spiketools.stats.shuffle.shuffle_bins.html#spiketools.stats.shuffle.shuffle_bins" title="spiketools.stats.shuffle.shuffle_bins"><code class="xref py py-func docutils literal notranslate"><span class="pre">shuffle_bins()</span></code></a>: shuffle spikes by circularly shuffling bins of varying length</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shuffle spikes using the different methods - ISI, circular, and bins</span>
<span class="n">shuffled_isis</span> <span class="o">=</span> <a href="../generated/spiketools.stats.shuffle.shuffle_isis.html#spiketools.stats.shuffle.shuffle_isis" title="spiketools.stats.shuffle.shuffle_isis" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_isis</span></a><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">n_shuffles</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">shuffled_circular</span> <span class="o">=</span> <a href="../generated/spiketools.stats.shuffle.shuffle_circular.html#spiketools.stats.shuffle.shuffle_circular" title="spiketools.stats.shuffle.shuffle_circular" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_circular</span></a><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">shuffle_min</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n_shuffles</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">shuffled_bins</span> <span class="o">=</span> <a href="../generated/spiketools.stats.shuffle.shuffle_bins.html#spiketools.stats.shuffle.shuffle_bins" title="spiketools.stats.shuffle.shuffle_bins" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_bins</span></a><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">bin_width_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">n_shuffles</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot original spike train</span>
<a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Non-shuffled&#39;</span><span class="p">,</span> <span class="n">vline</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_stats_001.png" srcset="../_images/sphx_glr_plot_stats_001.png" alt="Non-shuffled" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the different shuffles - ISI, circular, and bin</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <a href="../generated/spiketools.plts.utils.make_axes.html#spiketools.plts.utils.make_axes" title="spiketools.plts.utils.make_axes" class="sphx-glr-backref-module-spiketools-plts-utils sphx-glr-backref-type-py-function"><span class="n">make_axes</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a><span class="p">(</span><span class="n">shuffled_isis</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ISI Shuffle&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a><span class="p">(</span><span class="n">shuffled_circular</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Circular Shuffle&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a><span class="p">(</span><span class="n">shuffled_bins</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bin Shuffle&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_stats_002.png" srcset="../_images/sphx_glr_plot_stats_002.png" alt="ISI Shuffle, Circular Shuffle, Bin Shuffle" class = "sphx-glr-single-img"/><p>In the above we ran different shuffling approaches by calling different shuffling functions.</p>
<p>There is also the more general <a class="reference internal" href="../generated/spiketools.stats.shuffle.shuffle_spikes.html#spiketools.stats.shuffle.shuffle_spikes" title="spiketools.stats.shuffle.shuffle_spikes"><code class="xref py py-func docutils literal notranslate"><span class="pre">shuffle_spikes()</span></code></a> function, which can be used
call the different shuffling methods by passing an argument to define which method to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shuffle spikes using the general `shuffle_spikes` function</span>
<span class="n">shuffled_spikes</span> <span class="o">=</span> <a href="../generated/spiketools.stats.shuffle.shuffle_spikes.html#spiketools.stats.shuffle.shuffle_spikes" title="spiketools.stats.shuffle.shuffle_spikes" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_spikes</span></a><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">shuffle_min</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n_shuffles</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Plot shuffle spikes</span>
<a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a><span class="p">(</span><span class="n">shuffled_spikes</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Shuffled Spikes&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_stats_003.png" srcset="../_images/sphx_glr_plot_stats_003.png" alt="Shuffled Spikes" class = "sphx-glr-single-img"/></section>
<section id="compute-t-test-t-and-p-values-to-test-for-an-event-related-firing-rate-change">
<h3>Compute t-test t- and p-values to test for an event-related firing rate change<a class="headerlink" href="#compute-t-test-t-and-p-values-to-test-for-an-event-related-firing-rate-change" title="Permalink to this heading">¶</a></h3>
<p>First generate data that simulates a change in spike rate due to an event across 10 trials.</p>
<p>In this example case, across trials, we will simulate a change in firing rate
around an event. Specifically, we will simulate trials with an average firing rate of
5 Hz in the 3 second pre-event window, which changes to a firing rate of 10 Hz in a
3 second post-event window.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define simulation settings</span>
<span class="n">n_trials</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">rate_pre</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">rate_post</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">time_pre</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">time_post</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Simulate spiking activity across trials</span>
<span class="n">trial_spikes</span> <span class="o">=</span> <a href="../generated/spiketools.sim.trials.sim_trials_poisson.html#spiketools.sim.trials.sim_trials_poisson" title="spiketools.sim.trials.sim_trials_poisson" class="sphx-glr-backref-module-spiketools-sim-trials sphx-glr-backref-type-py-function"><span class="n">sim_trials_poisson</span></a><span class="p">(</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">rate_pre</span><span class="p">,</span> <span class="n">rate_post</span><span class="p">,</span> <span class="n">time_pre</span><span class="p">,</span> <span class="n">time_post</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the spike times across trials</span>
<a href="../generated/spiketools.plts.trials.plot_rasters.html#spiketools.plts.trials.plot_rasters" title="spiketools.plts.trials.plot_rasters" class="sphx-glr-backref-module-spiketools-plts-trials sphx-glr-backref-type-py-function"><span class="n">plot_rasters</span></a><span class="p">(</span><span class="n">trial_spikes</span><span class="p">,</span> <span class="n">vline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Spikes per trial&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_stats_004.png" srcset="../_images/sphx_glr_plot_stats_004.png" alt="Spikes per trial" class = "sphx-glr-single-img"/><p>Now that we have our simulated data, first we will calculate the firing rates across
the pre- and post-event time ranges.</p>
<p>To do so, we will use the <a class="reference internal" href="../generated/spiketools.measures.trials.compute_pre_post_rates.html#spiketools.measures.trials.compute_pre_post_rates" title="spiketools.measures.trials.compute_pre_post_rates"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_pre_post_rates()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define settings for the pre- and post- event time ranges</span>
<span class="n">pre_window</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">time_pre</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">post_window</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_post</span><span class="p">]</span>

<span class="c1"># Compute firing rates (Hz) pre- and post-event for all trials</span>
<span class="n">frs_pre</span><span class="p">,</span> <span class="n">frs_post</span> <span class="o">=</span> <a href="../generated/spiketools.measures.trials.compute_pre_post_rates.html#spiketools.measures.trials.compute_pre_post_rates" title="spiketools.measures.trials.compute_pre_post_rates" class="sphx-glr-backref-module-spiketools-measures-trials sphx-glr-backref-type-py-function"><span class="n">compute_pre_post_rates</span></a><span class="p">(</span><span class="n">trial_spikes</span><span class="p">,</span> <span class="n">pre_window</span><span class="p">,</span> <span class="n">post_window</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we can compute the t-test between the pre- and post-event firing rates across trials.</p>
<p>To do this, we will use the <a class="reference internal" href="../generated/spiketools.stats.trials.compute_pre_post_ttest.html#spiketools.stats.trials.compute_pre_post_ttest" title="spiketools.stats.trials.compute_pre_post_ttest"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_pre_post_ttest()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute a t-test between the pre- and post-event firing rates</span>
<span class="n">tval_t</span><span class="p">,</span> <span class="n">pval_t</span> <span class="o">=</span> <a href="../generated/spiketools.stats.trials.compute_pre_post_ttest.html#spiketools.stats.trials.compute_pre_post_ttest" title="spiketools.stats.trials.compute_pre_post_ttest" class="sphx-glr-backref-module-spiketools-stats-trials sphx-glr-backref-type-py-function"><span class="n">compute_pre_post_ttest</span></a><span class="p">(</span><span class="n">frs_pre</span><span class="p">,</span> <span class="n">frs_post</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The t-value is </span><span class="si">{:1.3f}</span><span class="s1">, with a p-value of </span><span class="si">{:.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tval_t</span><span class="p">,</span> <span class="n">pval_t</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>The t-value is -4.800, with a p-value of 9.735e-04
</pre></div>
</div>
<p>In the above, we separately computed and then compared the firing rates around
an event of interest.</p>
<p>To compute average firing rates and compare them all together, we can use the
<a class="reference internal" href="../generated/spiketools.stats.trials.compare_pre_post_activity.html#spiketools.stats.trials.compare_pre_post_activity" title="spiketools.stats.trials.compare_pre_post_activity"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare_pre_post_activity()</span></code></a> function. This is a convenience function
that computes the average pre/post firing as well as the t-test comparing pre to post.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare pre &amp; post stimulus firing</span>
<span class="n">avg_pre</span><span class="p">,</span> <span class="n">avg_post</span><span class="p">,</span> <span class="n">tval_t</span><span class="p">,</span> <span class="n">pval_t</span> <span class="o">=</span> <a href="../generated/spiketools.stats.trials.compare_pre_post_activity.html#spiketools.stats.trials.compare_pre_post_activity" title="spiketools.stats.trials.compare_pre_post_activity" class="sphx-glr-backref-module-spiketools-stats-trials sphx-glr-backref-type-py-function"><span class="n">compare_pre_post_activity</span></a><span class="p">(</span>\
    <span class="n">trial_spikes</span><span class="p">,</span> <span class="n">pre_window</span><span class="p">,</span> <span class="n">post_window</span><span class="p">,</span> <span class="n">avg_type</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>

<span class="c1"># Print the average firing rates &amp; t-test output</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average FR pre-event: </span><span class="si">{:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">avg_pre</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average FR post-event: </span><span class="si">{:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">avg_post</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The t-value is </span><span class="si">{:1.3f}</span><span class="s1">, with a p-value of </span><span class="si">{:.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tval_t</span><span class="p">,</span> <span class="n">pval_t</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Average FR pre-event: 5.200
Average FR post-event: 9.933
The t-value is -4.800, with a p-value of 9.735e-04
</pre></div>
</div>
</section>
<section id="compare-1st-and-2nd-half-of-trials">
<h3>Compare 1st and 2nd half of trials<a class="headerlink" href="#compare-1st-and-2nd-half-of-trials" title="Permalink to this heading">¶</a></h3>
<p>In real data, time or trial index may influence the outcome.</p>
<p>For another example analysis, next we will examine the binned pre / post firing
rates, split up by a split-half of the trials, to examine whether there is
evidence for a difference in spiking activity across different trials.</p>
<p>To do this, we can use the <a class="reference internal" href="../generated/spiketools.stats.trials.compare_trial_frs.html#spiketools.stats.trials.compare_trial_frs" title="spiketools.stats.trials.compare_trial_frs"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare_trial_frs()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine trials together into a 2d array</span>
<span class="n">all_trials_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">frs_pre</span><span class="p">,</span> <span class="n">frs_post</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># For each bin (pre and post event bins), compare 1st half of trials to 2nd half of trials</span>
<span class="n">pre_between_halfs</span><span class="p">,</span> <span class="n">post_between_halfs</span> <span class="o">=</span> <a href="../generated/spiketools.stats.trials.compare_trial_frs.html#spiketools.stats.trials.compare_trial_frs" title="spiketools.stats.trials.compare_trial_frs" class="sphx-glr-backref-module-spiketools-stats-trials sphx-glr-backref-type-py-function"><span class="n">compare_trial_frs</span></a><span class="p">(</span><span class="n">all_trials_data</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">all_trials_data</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>

<span class="c1"># Print out the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For pre bin comparison, the t-value is </span><span class="si">{:1.3f}</span><span class="s1">, a p-value of </span><span class="si">{:.3e}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
      <span class="n">pre_between_halfs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pre_between_halfs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For post bin comparison, the t-value is </span><span class="si">{:1.3f}</span><span class="s1">, with a p-value of </span><span class="si">{:.3e}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
      <span class="n">post_between_halfs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">post_between_halfs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>For pre bin comparison, the t-value is -0.666, a p-value of 5.244e-01.
For post bin comparison, the t-value is -0.086, with a p-value of 9.335e-01.
</pre></div>
</div>
</section>
<section id="run-2-way-anova-on-multiple-trials-data">
<h3>Run 2-way ANOVA on multiple trials data<a class="headerlink" href="#run-2-way-anova-on-multiple-trials-data" title="Permalink to this heading">¶</a></h3>
<p>Another way of testing whether there are event-related changes in firing rates
rate is to run an ANOVA.</p>
<p>To do that, we will first organize the firing rates and the factors in a pandas DataFrame.
To do so, we will first organize the data into a dictionary.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Put the firing rates into a single array</span>
<span class="n">pre_post_frs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">frs_pre</span><span class="p">,</span> <span class="n">frs_post</span><span class="p">])</span>

<span class="c1"># Create a boolean array to differentiate between pre- and -post event</span>
<span class="n">is_post_event</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frs_pre</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frs_pre</span><span class="p">))</span>

<span class="c1"># Create array with trial number information</span>
<span class="n">trial_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frs_pre</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frs_pre</span><span class="p">))])</span>

<span class="c1"># Put it all together into a dictionary</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fr&#39;</span> <span class="p">:</span> <span class="n">pre_post_frs</span><span class="p">,</span>
    <span class="s1">&#39;is_post_event&#39;</span> <span class="p">:</span> <span class="n">is_post_event</span><span class="p">,</span>
    <span class="s1">&#39;trial_idx&#39;</span> <span class="p">:</span> <span class="n">trial_idx</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now turn our data into a dataframe using the <a class="reference internal" href="../generated/spiketools.stats.anova.create_dataframe.html#spiketools.stats.anova.create_dataframe" title="spiketools.stats.anova.create_dataframe"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_dataframe()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the dataframe</span>
<span class="n">df_pre_post</span> <span class="o">=</span> <a href="../generated/spiketools.stats.anova.create_dataframe.html#spiketools.stats.anova.create_dataframe" title="spiketools.stats.anova.create_dataframe" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">create_dataframe</span></a><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Visualize the first entries of the dataframe</span>
<span class="n">df_pre_post</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fr</th>
      <th>is_post_event</th>
      <th>trial_idx</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.666667</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.000000</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.000000</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5.333333</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.000000</td>
      <td>0</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Now that we have our data organized into a dataframe, we can run an ANOVA.</p>
<p>Specifically, we will run an ANOVA to analyze whether there is an effect of the event on
firing rates, as well as checking whether there is an effect of trial index on firing rate.</p>
<p>To run the ANOVA, we need to define the formula we want to run.</p>
<p>Then, using the dataframe and the formula, we can use
the <a class="reference internal" href="../generated/spiketools.stats.anova.fit_anova.html#spiketools.stats.anova.fit_anova" title="spiketools.stats.anova.fit_anova"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit_anova()</span></code></a> function to fit our ANOVA.</p>
<p>Note that in this example, we did not evaluate the effect of the interaction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the formula for the ANOVA to fit</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;fr ~ C(is_post_event) + C(trial_idx)&#39;</span>

<span class="c1"># Run 2-way ANOVA without interaction on our dataframe</span>
<span class="n">anova_pre_post</span> <span class="o">=</span> <a href="../generated/spiketools.stats.anova.fit_anova.html#spiketools.stats.anova.fit_anova" title="spiketools.stats.anova.fit_anova" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">fit_anova</span></a><span class="p">(</span><span class="n">df_pre_post</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">anova_type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Print out results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F-value, pre vs post: </span><span class="si">{:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anova_pre_post</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="s1">&#39;C(is_post_event)&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P-value, pre vs post: </span><span class="si">{:.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anova_pre_post</span><span class="p">[</span><span class="s1">&#39;PR(&gt;F)&#39;</span><span class="p">][</span><span class="s1">&#39;C(is_post_event)&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F-value, trial index: </span><span class="si">{:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anova_pre_post</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">][</span><span class="s1">&#39;C(trial_idx)&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P-value, trial index: </span><span class="si">{:.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anova_pre_post</span><span class="p">[</span><span class="s1">&#39;PR(&gt;F)&#39;</span><span class="p">][</span><span class="s1">&#39;C(trial_idx)&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>F-value, pre vs post: 23.042
P-value, pre vs post: 9.735e-04
F-value, trial index: 0.793
P-value, trial index: 6.325e-01
</pre></div>
</div>
</section>
<section id="compute-the-empirical-p-value-and-z-score-from-distribution-of-surrogates">
<h3>Compute the empirical p-value and z-score from distribution of surrogates<a class="headerlink" href="#compute-the-empirical-p-value-and-z-score-from-distribution-of-surrogates" title="Permalink to this heading">¶</a></h3>
<p>Next, we will use surrogate data to test whether our analysis reflects a significant effect.</p>
<p>First we calculate the change in firing rate, comparing the pre- and post-event rates as
(delta = post firing rate - pre firing rate).</p>
<p>To test this, we will compute the average event related firing rate difference, and then
compute the empirical p-value and z-score for this using surrogates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get average firing rate difference between post and pre event</span>
<span class="n">fr_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">frs_post</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">frs_pre</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Difference in post-pre firing rate of real data: </span><span class="si">{:1.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fr_diff</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Difference in post-pre firing rate of real data: 4.73
</pre></div>
</div>
<p>To compare the delta firing rate, we need to generate our distribution of surrogates.</p>
<p>Thus, we will shuffle the data from the first trial (as an example) 100 times (using isis).
For each of the shuffles, we will calculate the change in firing rate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Settings for shuffling the data</span>
<span class="n">n_shuffles</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">shuffled_diffs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">shuffle_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shuffles</span><span class="p">):</span>

    <span class="c1"># Shuffle the spike data - shuffle each trial to make a new set of shuffled trials</span>
    <span class="n">shuffled_trials</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>
        <span class="n">shuffled_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../generated/spiketools.stats.shuffle.shuffle_isis.html#spiketools.stats.shuffle.shuffle_isis" title="spiketools.stats.shuffle.shuffle_isis" class="sphx-glr-backref-module-spiketools-stats-shuffle sphx-glr-backref-type-py-function"><span class="n">shuffle_isis</span></a><span class="p">(</span><span class="n">trial_spikes</span><span class="p">[</span><span class="n">t_ind</span><span class="p">],</span> <span class="n">n_shuffles</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Compute and collect the measure of interest on the shuffled data</span>
    <span class="n">shuffled_frs_pre</span><span class="p">,</span> <span class="n">shuffled_frs_post</span> <span class="o">=</span> <a href="../generated/spiketools.measures.trials.compute_pre_post_rates.html#spiketools.measures.trials.compute_pre_post_rates" title="spiketools.measures.trials.compute_pre_post_rates" class="sphx-glr-backref-module-spiketools-measures-trials sphx-glr-backref-type-py-function"><span class="n">compute_pre_post_rates</span></a><span class="p">(</span>\
        <span class="n">shuffled_trials</span><span class="p">,</span> <span class="n">pre_window</span><span class="p">,</span> <span class="n">post_window</span><span class="p">)</span>
    <span class="n">shuffled_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shuffled_frs_post</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shuffled_frs_pre</span><span class="p">))</span>
</pre></div>
</div>
<p>Now that we have shuffled spikes, we can compute our measure of interest on the
surrogate data. This will give us a surrogate distribution which we can then use
to compute the empirical p-value and the z-score, to examine if the effect in the
real data is greater than expected by change (in the shuffles).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate surrogate measures</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimum delta FR across surrogates: </span><span class="si">{:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shuffled_diffs</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Maximum delta FR across surrogates: </span><span class="si">{:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shuffled_diffs</span><span class="p">)))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Minimum delta FR across surrogates: 7.100
Maximum delta FR across surrogates: 8.600
</pre></div>
</div>
<p>Now we can compute the empirical p-value and z-score of change in firing rate from
the distribution of surrogates, using the <a class="reference internal" href="../generated/spiketools.stats.permutations.compute_surrogate_stats.html#spiketools.stats.permutations.compute_surrogate_stats" title="spiketools.stats.permutations.compute_surrogate_stats"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_surrogate_stats()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate empirical p-value and z-score of difference in firing rate with respect to surrogates</span>
<span class="n">surr_pval</span><span class="p">,</span> <span class="n">surr_zscore</span> <span class="o">=</span> <a href="../generated/spiketools.stats.permutations.compute_surrogate_stats.html#spiketools.stats.permutations.compute_surrogate_stats" title="spiketools.stats.permutations.compute_surrogate_stats" class="sphx-glr-backref-module-spiketools-stats-permutations sphx-glr-backref-type-py-function"><span class="n">compute_surrogate_stats</span></a><span class="p">(</span><span class="n">fr_diff</span><span class="p">,</span> <span class="n">shuffled_diffs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">surr_pval</span><span class="p">,</span> <span class="n">surr_zscore</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the surrogate comparison, the z-score is </span><span class="si">{:1.3f}</span><span class="s1">, and the p-value is </span><span class="si">{:.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
    <span class="n">surr_zscore</span><span class="p">,</span> <span class="n">surr_pval</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>1.0 -10.136467109369793
For the surrogate comparison, the z-score is -10.136, and the p-value is 1.000e+00
</pre></div>
</div>
<p>Lastly, plot the distribution of surrogates with calculated delta firing rate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot distribution of surrogates, with calculated delta firing rate &amp; p-value</span>
<a href="../generated/spiketools.plts.stats.plot_surrogates.html#spiketools.plts.stats.plot_surrogates" title="spiketools.plts.stats.plot_surrogates" class="sphx-glr-backref-module-spiketools-plts-stats sphx-glr-backref-type-py-function"><span class="n">plot_surrogates</span></a><span class="p">(</span><span class="n">shuffled_diffs</span><span class="p">,</span> <span class="n">fr_diff</span><span class="p">,</span> <span class="n">surr_pval</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_stats_005.png" srcset="../_images/sphx_glr_plot_stats_005.png" alt="plot stats" class = "sphx-glr-single-img"/></section>
<section id="compute-f-value-from-spiking-data-using-1-way-anova">
<h3>Compute f-value from spiking data using 1-way ANOVA<a class="headerlink" href="#compute-f-value-from-spiking-data-using-1-way-anova" title="Permalink to this heading">¶</a></h3>
<p>In this example, we will compute a statistical test of whether there is an effect
of spatial position on neuron firing.</p>
<p>To do so, we will simulate spike trains across trials (8 seconds) across spatial bins.</p>
<p>The simulated data will then be organized (per trial, per bin) into dataframes,
which we can then use to fit the ANOVA.</p>
<p>For this example, we will generate a new set of spiking data.
Note that this simulation matches the one used in the Spatial Analysis tutorial.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate some positional data</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
<span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
<span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">])</span>

<span class="c1"># Set number of spatial bins, 3 x-bins and 5 y-bins</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Compute spatial bin edges</span>
<span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <a href="../generated/spiketools.spatial.occupancy.compute_bin_edges.html#spiketools.spatial.occupancy.compute_bin_edges" title="spiketools.spatial.occupancy.compute_bin_edges" class="sphx-glr-backref-module-spiketools-spatial-occupancy sphx-glr-backref-type-py-function"><span class="n">compute_bin_edges</span></a><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>

<span class="c1"># Set number of trials</span>
<span class="n">n_trials</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">bin_firing_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>

    <span class="c1"># Simulate a spike train with a sampling rate of 1000 Hz</span>
    <span class="n">spike_train</span> <span class="o">=</span> <a href="../generated/spiketools.sim.train.sim_spiketrain_binom.html#spiketools.sim.train.sim_spiketrain_binom" title="spiketools.sim.train.sim_spiketrain_binom" class="sphx-glr-backref-module-spiketools-sim-train sphx-glr-backref-type-py-function"><span class="n">sim_spiketrain_binom</span></a><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>

    <span class="c1"># Get spike position bins</span>
    <span class="n">spike_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spike_train</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Get x and y position bins corresponding to spike positions</span>
    <span class="n">spike_x</span><span class="p">,</span> <span class="n">spike_y</span> <span class="o">=</span> <a href="../generated/spiketools.spatial.occupancy.compute_bin_assignment.html#spiketools.spatial.occupancy.compute_bin_assignment" title="spiketools.spatial.occupancy.compute_bin_assignment" class="sphx-glr-backref-module-spiketools-spatial-occupancy sphx-glr-backref-type-py-function"><span class="n">compute_bin_assignment</span></a><span class="p">(</span><span class="n">position</span><span class="p">[:,</span> <span class="n">spike_bins</span><span class="p">],</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span><span class="p">,</span>
                                              <span class="n">include_edge</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Compute firing rate in each bin</span>
    <span class="n">bin_firing</span> <span class="o">=</span> <span class="p">(</span><a href="../generated/spiketools.spatial.occupancy.compute_bin_counts_assgn.html#spiketools.spatial.occupancy.compute_bin_counts_assgn" title="spiketools.spatial.occupancy.compute_bin_counts_assgn" class="sphx-glr-backref-module-spiketools-spatial-occupancy sphx-glr-backref-type-py-function"><span class="n">compute_bin_counts_assgn</span></a><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">xbins</span><span class="o">=</span><span class="n">spike_x</span><span class="p">,</span> <span class="n">ybins</span><span class="o">=</span><span class="n">spike_y</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">bin_firing_all</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">bin_firing</span>
</pre></div>
</div>
<p>Note that in this example we have a different data organization, due to the binning, and so
in this case we will create a dataframe using the <a class="reference internal" href="../generated/spiketools.stats.anova.create_dataframe_bins.html#spiketools.stats.anova.create_dataframe_bins" title="spiketools.stats.anova.create_dataframe_bins"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_dataframe_bins()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Organize spiking data into dataframe</span>
<span class="n">df</span> <span class="o">=</span> <a href="../generated/spiketools.stats.anova.create_dataframe_bins.html#spiketools.stats.anova.create_dataframe_bins" title="spiketools.stats.anova.create_dataframe_bins" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">create_dataframe_bins</span></a><span class="p">(</span><span class="n">bin_firing_all</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualize the first entries of the dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>trial</th>
      <th>bin</th>
      <th>fr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>3</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>4</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Once we have the dataframe, we can fit the ANOVA using the
<a class="reference internal" href="../generated/spiketools.stats.anova.fit_anova.html#spiketools.stats.anova.fit_anova" title="spiketools.stats.anova.fit_anova"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit_anova()</span></code></a> function, as above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute f_value from spiking data using ANOVA</span>
<span class="n">f_val</span> <span class="o">=</span> <a href="../generated/spiketools.stats.anova.fit_anova.html#spiketools.stats.anova.fit_anova" title="spiketools.stats.anova.fit_anova" class="sphx-glr-backref-module-spiketools-stats-anova sphx-glr-backref-type-py-function"><span class="n">fit_anova</span></a><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;fr ~ C(bin)&#39;</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="s1">&#39;C(bin)&#39;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;f_val&#39;</span><span class="p">,</span> <span class="n">anova_type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F-value: </span><span class="si">{:.3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_val</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>F-value: 38.2
</pre></div>
</div>
<p>Note that the procedure we employed here could also be combined with what we did above
to shuffle the data, in order to calculate the ANOVA F-value across surrogates and
then compare to the real data.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.871 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-plot-stats-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/spiketools/spiketools/gh-pages?filepath=notebooks/auto_tutorials/plot_stats.ipynb"><img alt="Launch binder" src="../_images/binder_badge_logo.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/3e1328885e3703795461db6650f78c35/plot_stats.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_stats.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ffee3d7f5d3bca69a76202fc26488f07/plot_stats.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_stats.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2021-2023, Thomas Donoghue.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>